# 你不知道的JavaScript: Up & Going
# 第一章: 走进编程

欢迎你进入 **你不知道的JavaScript** (**YDKJS**) 系列.

*Up & Going*介绍了一些基本的编程概念——当然我们会更加倾向于特别介绍JavaScript（经常简称为JS）——以及如何进一步理解本系列的其他主题内容。特别是当你刚接触编程或者JavaScript，这本书会简要的介绍你需要掌握的知识。

这本书一开始就从高级层面解释基本的编程概念。如果你之前没有编程经验并且希望找到一些书来帮助你学习并且透彻的理解JavaScript，这个系列的丛书就是你要找的。

通过第一章你可以找到一些快速入门的东西，来帮助你更多的了解和实践，进入编程的世界。这里有许多很棒的程序设计入门指南帮助你深入探讨这些主题，我建议你向它们学习，并不局限于这一章的介绍。

第1章应该找到一个快速概述的事情你想要更多地了解和实践进入编程。还有其他许多奇妙的编程的介绍资料可以帮助你进一步深入探讨这些话题,我鼓励大家向他们学习本章除了。

第1章应接触作为你要了解和实践进入编程事情的简要概述。也有许多其他的梦幻般的程序设计入门的资源，可以帮助您深入探讨这些主题进一步，我建议你向他们学习，除了这一章。

一旦你了解了编程基础概念，第二章将引导你进入JavaScript的编程世界。第二章介绍了什么是JavaScript，但同样，这不是一个全面的指南——这是**YDKJS**剩余部分要做的工作。

如果你已经熟悉JavaScript了，可以直接阅读第三章，了解一下你可以从*YDKJS*系列中学到什么，然后开始阅读吧！

## 代码

让我们从头开始吧！

程序，通常被称为**源代码**或**代码**，是一组特殊的指令来告诉计算机应该执行什么任务。通常代码保存在文本文件中，尽管你可以直接在浏览器的开发者控制台中输入JavaScript代码，我们接下来会讲解这个。

有效的格式和指令的组合规则被称为**计算机语言**，有时也被叫做（编程语言的）**语法**，就像英语语言告诉你如何拼写单词，以及如何用单词和标点来构造有效的句子。

### 语句

在计算机语言中，执行特定任务的一组单词、数字和运算符称为**语句**。在JavaScript中，语句如下所示：

```js
a = b * 2;
```

字符`a`和`b`称为**变量**（参见**变量**），变量就像一个简单的盒子可以装入你的任何东西。在程序中，变量保存值（如数字`42`），给程序使用。你可以把变量理解为代表值的占位符。

相比之下，`2`仅仅代表值本身，称为**字面量**，因为它是独立的，没有存储在变量中。

字符`=`和`*`称为**运算符**（参见“运算符”）——它们与值和变量执行一些操作，如分配（专业术语称“赋值”）和数学乘法运算。

在JavaScript中大多数语句以分号（;）结尾。

语句`a = b * 2;`告诉计算机，获取变量`b`中的值，乘以`2`，然后将计算结果存入另外一个变量`a`中。

程序就是一组的语句，它们表述了为实现程序目的所需的步骤集合。

### 表达式

语句由一个或者多个**表达式**组成。表达式是一个变量或者值的引用，或者一组变量和值以及运算符的组合。

比如:

```js
a = b * 2;
```

这条语句中有四个表达式：

* `2`是一个**字面量表达式**
* `b`是一个**变量表达式**，表示获取这个变量当前的值
* `b * 2`是一个**算术表达式**，表示做乘法运算
* `a = b * 2`是一个**赋值表达式**，表示将`b * 2`表达式的结果赋予变量`a`（之后会更多的提到赋值操作）

一个单独的一般表达式也被称为**表达式语句**，比如下面：

```js
b * 2;
```

这种表达式语句并不常见或者有用，因为它对程序的运行并没有产生任何影响——它就是将`b`的值取出来，然后乘以`2`，然而并没有对结果进行任何操作。

一种更加常见的表达式语句是**调用表达式**语句（常见“函数”），整个语句就是函数调用表达式本身：

```js
alert( a );
```

### 执行程序

这组编程语句如何告诉计算机该做什么？程序需要被**执行**，也被称为**运行程序**。

像`a = b * 2`这样的语句有利于开发者阅读和书写，但是计算机并不能直接理解这种格式。所以，在电脑上需要一个特殊的工具（可以是**解释器**或者**编译器**）来将你写的代码翻译成计算机能够理解的指令。

对于某些计算机语言，每当程序执行的时候，工具会从上到下，逐行执行这种命令翻译工作，这通常被称为**解释**代码。

对于其他的语言，这种翻译工作会提前完成，称为**编译**代码，所以当之后程序**运行**的时候，计算机实际执行的是编译之后的指令。

很明显，JavaScript是**解释型**语言，因为JavaScript源代码都是在运行时处理的。但这并不完全准确。JavaScript引擎实际上是先**编译**代码，然后立即执行编译后的代码。

**注意：** 有关JavaScript编译的更多信息，请参阅本系列的“作用域和闭包”的前两章。

## 尝试一下

本章将通过一些简单的代码片段来介绍每个编程概念，全部都是用JavaScript写的（你懂的！）。

特别的强调一下：当你阅读本章的时候——你需要花时间多练习几次——你应该通过敲代码来练习每个概念。最简单的方法就是打开你浏览器中的开发者工具（火狐、谷歌浏览器、IE等）。

**提示：**通常情况下，你可以通过键盘快捷键或者菜单项来启动开发者控制台。想要了解更多有关如何在你最喜欢的浏览器中打开和使用控制台的信息，参见“掌握开发者工具控制台”(http://blog.teamtreehouse.com/mastering-developer-tools-console)。要一次输入多行到控制台，使用`<shift> + <enter>`移动到下一行。一旦你输入`<enter>`，控制台就会运行你刚刚输入的代码。

让我们熟悉一下在控制台中运行代码的过程。首先，我建议你在浏览器中打开一个空页面。我更喜欢在地址栏输入`about:blank`来打开空页面。然后，确保你的开发者控制台是打开的，就像我们刚刚提到的那样。

现在，输入这段代码，看看它是如何运行的：

```js
a = 21;

b = a * 2;

console.log( b );
```

前面的代码输入到Chrome的控制台，应该产生类似以下内容：

<img src="fig1.png" width="500">

来吧，试试看吧。学习编程的最好方法是开始编码！

### 输出

在前面的代码片段中，我们使用了`console.log（..）`。让我们简要的讲解下这行代码是什么意思。

你可能已经猜到了，这就是我们在开发者控制台打印文本的方式（又名**输出**给用户）。我们有必要解释一下它的两个特点。

第一，`log( b )`部分被称为函数调用（参见“函数”）。它所做的事情就是，我们将`b`变量交给`log`函数，然后它取出`b`的值把它打印到控制台。

第二，`console.`部分是一个对象引用，函数`log(..)`就在这个对象里面。我们将在第二章中更详细的讲解对象和它的属性。

另一种创建输出的方法就是运行`alert(..)`语句。例如：

```js
alert( b );
```

如果你运行那段代码，你会发现浏览器弹出了一个“OK”对话框，它的内容是变量`b`的值，而不是打印输出到控制台。通常来说，使用`console.log(..)`学习编码并且在控制台运行程序会比使用`alert(..)`更容易，因为你可以一次输出多个值，而且不会打断浏览器界面响应。

在本书中，我们使用`console.log(..)`来输出信息。

### 输入

虽然我们一直在讨论输出，你可能也想知道如何**输入**（即从用户那边接收信息）。

最常见的方式是，在HTML页面中向用户显示表单元素（如文本框），他们可以输入信息到表单中，然后使用JS将用户的输入读取到程序当中。

如果仅仅只是为了简单的学习和演示（就像你当前跟随本书所做的一样），这里有一个更加简单的方法来获取用户的输入，那就是使用`prompt(..)`函数：

```js
age = prompt( "Please tell me your age:" );

console.log( age );
```

你可能已经猜到了，你传递给`prompt(..)`的信息——在这个例子中，`"Please tell me your age:"`——被打印在弹出框里。

这应该类似以下内容：

<img src="fig2.png" width="500">

一旦你点击提交输入的文本，你会发现你输入的值存储在变量`age`中，接着我们使用`console.log(..)`将它**输出**。

<img src="fig3.png" width="500">

为了让我们在学习基本编程概念的时候保持简单，在本书中的例子不需要输入。但是现在你已经了解了如何使用`prompt(..)`，如果你想挑战自己，你可以尝试在接下来的实例是使用输入。

## 运算符

运算符是我们用来操作变量和值的。我们已经看到了两个JavaScript运算符，`=`和`*`。

`*`运算符是用来表示数序乘法的，这很简单吧！

`=`等号运算符用来**赋值**——我们首先计算出`=`**右边**（来源值）的值，然后把它放入`=`**左边**（目标变量）我们指定的变量中。

**警告：**这种以相反方向来赋值的操作可能看起来很奇怪。不像`a = 42`，有些人可能喜欢翻转顺序，使得源值在左边，目标变量在右边，如`42 -> a`（在JavaScript中这是无效的）。不幸的是，像`a = 42`这种有序的形式，以及类似的变形，在现代编程语言中相当普遍。如果你感觉不自然，那就花费一些时间在你心中反复排练下这种顺序，适应它吧。

考虑如下：

```js
a = 2;
b = a + 1;
```

在这里，我们将`2`赋值给变量`a`，然后获取变量`a`的值（仍然是`2`），加`1`得到结果`3`，最后将这个值存储在变量`b`中。

虽然这不是一个技术上的运算符，但是你需要明白每个程序中的关键字`var`，因为它你声明**变量**的主要方式（参见“变量”）。

在使用变量之前，你总是应该通过名字来声明变量。但是，在每个**作用域**（参见“作用域”）你只需要为每个变量声明一次就行，他可以在需要的时候使用任意多次。例如：

```js
var a = 20;

a = a + 1;
a = a * 2;

console.log( a );	// 42
```

以下是JavaScript中一些最常见的运算符：

* 赋值：如：`a = 2`中的`=`
* 算术：`+`（加法），`-`（减法），`*`（乘法）和 `/` (除法)，如：`a * 3`
* 复合赋值：`+=`，`-=`，`*=` 和 `/=` 都是复合赋值运算符，它们组合了算术和赋值两个操作，如：`a += 2` (等同于`a = a + 2`)
* 递加/递减：`++`（递加），`--`（递减），如：`a++`（等同于`a = a + 1`）
* 对象属性访问：如：`console.log()`中的`.` 
对象是在称为属性特定的命名位置持有其他值的值。`obj.a`表示一个对象值，变量名为`obj`，它带有一个叫`a`的属性。也可以通过`obj["a"]`这种方式来访问属性。参见第二章。

* 比较：`==`（一般等于），`===`（严格等于），`!=`（一般不等），`!==`（严格等于），如：`a == b`。
参见第二章的“值与类型”

* 比较：`<`（小与），`>`（大于），`<=`（小于等于），`>=`（大于等于），如：`a <= b`。
参见第二章的“值与类型”

* 逻辑：`&&`（与），`||`（或），如：`a || b`表示选择`a` **或者** `b`
这些操作符是用来表示复合条件语句（参见“条件表达式”），就像`a`**或者**`b`为真。

**注意：**想要了解更多的细节，以及了解这里没有讲解到的运算符，参见Mozilla Developer Network (MDN)'s "Expressions and Operators" (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Expressions_and_Operators)。

## 值和类型

如果您在手机商店问员工一部特定的手机的价格，他们说：“99，99”（即，$99.99），他们会告诉你一个实际上的美元数字代表你需要支付（加税）多少钱才能买它。如果你想购买两部，你可以很容易通过心算就知道你需要支付$199.98，一部手机价格的两倍。

如果同样的员工拿起另一个类似的手机，但说这是“免费”的（可能是跟你开玩笑），他们不会给你一个数字，而是另外一种表示价格（￥0.00）的单词——“免费”。

当你接着问手机是否包括充电器，这个问题的答案只能是“是”或“否”。

这很类似于当你在程序中表达值的时候，你会根据它们的用途来选择不同的表示方法。

在编程术语中，这种不同的值表示被称为**类型**。JavaScript内置了一些类型，我们称之为**基本**类型。

* 当你想要做数学运算，你可能想要`number`（数字类型）
* 当你想要往屏幕上打印值，你需要`string`（一个或多个字符，单词，句子）
* 当你需要在程序中做决定，你需要`boolean` (`true` 或 `false`)

被直接包含在源代码中的值称为**字面量**。`string`字面量是由双引号`“...”`或单引号（`'...'`）——唯一的区别是风格偏好。`number`和`boolean`字面量表现为`42`和`true`等。

考虑如下：

```js
"I am a string";
'I am also a string';

42;

true;
false;
```

除了`string`/`number`/`boolean`值类型，很多的编程语言还提供了**数组**、**对象**、**函数**以及更多的类型。我们在本章和接下来的内容，会讲解更多有关值和类型的知识。

### 类型转换

如果你有一个数字类型的值，但是需要把它打印到屏幕上，这个时候你需要将这个数字转换为字符串，在JavaScript中，这个转换称之为**强制转换**。同样，如果你进入了包含一系列数字的电子商务网站上，那些都是字符串，但是如果你需要用这些字符串数字进行算术运算，你就需要把字符串**强制**转换成数字。

JavaScript提供了几种不同的方法用来在**类型**之间进行强制转换。例如：

```js
var a = "42";
var b = Number( a );

console.log( a );	// "42"
console.log( b );	// 42
```

使用如上所示的`Number(..)`（一个内置函数）是一种**显式**强制转换，它能把任何类型转换为`number`（数字）类型。这应该最直截了当的。

但是一个有争议的话题是，当你尝试比较两个不同类型的值的时候，你需要**隐式**强制转换。

当比较字符串`“99.99”`和数字`99.99`，大多数人都认为它们是等价的。但他们不完全一样的，不是吗？它们是有着相同值的不同表示，两种不同的**类型**。你可以说它们是“非严格相等”，难道不是吗？

为了帮助你应对这些常见的情况，JavaScript有时会进行**隐式**强制转换值使得他们的类型相匹配。

所以，如果你使用非严格等于`==`运算符对`"99.99" == 99.99`做比较，JavaScript会将左边的`"99.99"`转换为与它等价的`number`（数字）值`99.99`。然后比较就变成了`99.99 == 99.99`，这个结果当然就是`true`。

虽然旨在帮助你，但是如果你没有花时间去学习规则控制它的行为，隐式转换会给你造成混乱。许多的JS开发者从来没有花时间了解过，所以大家普遍的感觉是，隐式转换是混乱的，会导致程序出现意外的bug，因此，应该尽量避免它。它甚至有时被认为是语言的设计缺陷。

然而，隐式强制是**可以学会**的技巧，而且**应该被认真的学习**，如果你想要认真学习JavaScript编程。一旦你掌握了这些规则，它不仅不混淆，还可以让你的程序变得更好！这种努力是值得的。

**注意：**有关强制的更多信息，请参阅本题第二章和本系列中“类型和语法”的第四章。

## 代码注释

手机店员工可能会记下新发布手机的功能或者公司的新计划。这些笔记只是为了员工自己——而不是给他们的客户阅读的。然而，通过记录他们应该告诉客户什么以及如何告诉客户，能够更好的帮助员工做好他们的工作。

学习写代码最重要的一课就是你必须明白，你写代码不仅仅是为计算机而写代码。对编译器来说代码仅仅只是比特而已，但对开发者来说却不是。（感觉翻译不来，给出原文：One of the most important lessons you can learn about writing code is that it's not just for the computer. Code is every bit as much, if not more, for the developer as it is for the compiler.）

你的计算机只关心机器码（编译器编译之后的一串0和1的序列）。在你的职业生涯中，你可能会写很多的代码，但是最终都会被转换成机器码。你所做的如何编写你的代码的决定，将不仅仅对你、对你的其他团队成员甚至未来的你自己产生极大的影响。

你应该努力写出不仅仅是可正常运行的代码，还需要在检查的时候也有意义。尽量给变量（参见“变量”）和函数（参见“函数”）选择一个好的名称，能够让你的程序生涯走得更远。

另外一个重要的部分就是代码注释。它们是插入你代码中的一些文本，用来向人解释你的代码。解释器或者编译器会忽略掉这些注释。

这里有许多的建议，关于如何写出良好注释的代码；我们无法定义绝对通用的规则。但是一些建议和指导还是十分有用的：

* 没有注释的代码是不合格的代码
* 过度的注释（例如：每行都有）可能是写得不好的代码的标志
* 注释应该解释**为什么**，而不是**这是什么**。如果代码容易引起混乱，注释也可以解释**如何实现**。

在JavaScript中，有两种类型的注释：单行注释和多行注释。

考虑如下:

```js
// This is a single-line comment

/* But this is
       a multiline
             comment.
                      */
```

如果你打算把评论正上方一条语句，或者是在一行的末尾注释，`//`单行注释是合适的。在`//`后面的一切被视为注释（并因此被编译器忽略），一直到行的结尾。单行注释中可以出现任何字符。

考虑如下:

```js
var a = 42;		// 42 is the meaning of life
```

如果你需要在多行注释你的代码，那`/* .. */`多行注释是合适的。

下面是多行注释的一个常见用法：

```js
/* The following value is used because
   it has been shown that it answers
   every question in the universe. */
var a = 42;
```

它可以出现在一行的任意位置，甚至在一行的中间，因为`*/`表示注释结束。例如：

```js
var a = /* arbitrary value */ 42;

console.log( a );	// 42
```

在多行注释的内容中不能出现`*/`，因为它会被解释器认为是结束注释。

你一定会希望通过写注释代码的习惯出发，开始编程的学习。在本章的其余部分，你会看到我用注释来解释的东西，所以在自己的实践中做同样的事情。相信我，大家谁读你的代码都会感谢你的！

## 变量

许多的程序都需要跟踪值的变化，因为它在整个程序的生命周期中，会被各种任务操作所改变。

最简单的方法就是在你的程序中将一个值赋给一个象征性的容器，我们称之为**变量**——之所以这么称，是因为容器中的值能够根据需要而不断变化。

在一些编程语言中，你声明一个变量（容器）持有特定类型的值，如`number`或`string`。**静态类型**，也被称为**强类型**，能够防止意外的值转换，从而提高程序的正确性。

其他语言强调值的类型而不是变量。 **弱类型**，也被称为**动态类型**，允许一个变量在任何时间保存任何类型的值。它对程序的典型好处就是提高了程序的灵活性，因为在程序的逻辑流程中，它允许一个变量代表一个任意类型的值。

JavaScript使用后一种方式，**动态类型**，这意味着变量可以保存任何**类型**，而不用强制声明类型。

正如前面所提到的，我们使用`var`声明一个变量——注意在声明的时候没有其他类型声明的信息。考虑这个简单的程序：

```js
var amount = 99.99;

amount = amount * 2;

console.log( amount );		// 199.98

// convert `amount` to a string, and
// add "$" on the beginning
amount = "$" + String( amount );

console.log( amount );		// "$199.98"
```

变量`amount`开始的时候存储的是数字`99.99`，之后存储的是`amount * 2`的结果，也就是`199.98`。

第一个`console.log(..)`命令已经**隐式**的转换`number`值成`string`然后打印输出。

然后语句`amount = "$" + String(amount)`**显式**转换值`199.98`为`string`类型，并且在它前面加上了一个字符`"$"`。此时，`amount`现在存储了`string`值`"$199.98"`，因此第二个语句`console.log(..)`不用做任何转换就可以打印输出。

JavaScript开发者会发现使用一个`amount`变量来存储`99.99`，`199.98`和`"$199.98"`的值的灵活性。热衷静态类型的开发者宁愿用一个独立的变量比如`amountStr`来存储最终的变量值`"$199.98"`，因为它们是不同的类型。

无论哪种方式，你会注意到，在程序的运行过程中`amount`存储了一个变化的运行值，说明了变量的主要目的：管理程序的**状态。**

换句话说，当你的程序运行的时候，**状态**跟踪了值的变化。

变量的另外一个用途就是集中配置一些值。在程序的运行过程中，你声明了一个变量，并且将一个不打算改变的值存储在这个变量中，这个变量通常被称为**常量**。

通常在程序的顶部声明这些**常量**，这样当你需要修改它们的值的时候你就可以很方便的找到。按照惯例，JavaScript的作为变量的常量，变量名通常都是大写，多个单词之间用下划线`_`分割。

这里是一个愚蠢的例子：

```js
var TAX_RATE = 0.08;	// 8% sales tax

var amount = 99.99;

amount = amount * 2;

amount = amount + (amount * TAX_RATE);

console.log( amount );				// 215.9784
console.log( amount.toFixed( 2 ) );	// "215.98"
```

**注意：**函数`log(..)`能够通过对象访问符被值`console`访问到，与此类似，这里`toFixed(..)`也是一个函数，能够通过对象访问符被`number`访问到。JavaScript的`number`不能自动格式化美元——引擎不知道你的意图，而且这里也没有货币类型。`toFixed(..)`让我们指定`number`四舍五入多少位小数，并且返回一个`string`。

变量`TAX_RATE`只是按约定是**常量**——这里并没有什么特殊机制来防止它被修改。但是，如果城市提高了营业税税率到9%，我们仍然可以很容易地在一个地方找到`TAX_RATE`并为它分配值`0.09`，而不是去寻找散落在程序中各个地方的`0.08`然后去更新他们。

在写这篇文章的时候，最新版本的JavaScript（俗称“ES6”）包含一种新的声明**常量**的方法，通过使用`const`代替`var`：

```js
// as of ES6:
const TAX_RATE = 0.08;

var amount = 99.99;

// ..
```

不能改变其值的常量就像变量一样有用，并且常量防止了在其初始化赋值之后，在其他某处进行意外的修改。如果你试图在第一次声明常量`TAX_RATE`之后，又给它赋予一个不同的值，你的程序会拒绝这次改变（在严格模式中，会抛出一个错误——参见第二章的“严格模式”）。

顺便说一句，那种防止错误的“保护”类似于静态类型的类型增强，所以你应该明白为什么其他静态类型的语言会吸引人！

**注意：**想要了解有关在你的程序中如何使用不同的变量值的更多信息，参见本系列的“类型和语法”。

## 块

手机店员工必须经过一系列的步骤才能让你完成购买手机的操作。

同样，在代码中，我们经常需要将一系列的语句组合在一起，我们称之为**块**。在JavaScript中，块是定义在一对花括号`{ .. }`中的一条或多条语句。考虑如下：


```js
var amount = 99.99;

// a general block
{
	amount = amount * 2;
	console.log( amount );	// 199.98
}
```

这种独立的块`{ .. }`是有效的，但是在JS程序中并不常见。典型地，块被附属到一些其他的控制语句上，比如`if`语句（参见“条件语句”）或循环语句（参见“循环”）。例如：


```js
var amount = 99.99;

// is amount big enough?
if (amount > 10) {			// <-- block attached to `if`
	amount = amount * 2;
	console.log( amount );	// 199.98
}
```

我们将在下一节中解释`if`语句，但是正如你所见，块`{ .. }`与它的两个语句被连接到`if (amount > 10)`上，只有当条件通过时，块里面的语句才会被执行。

**注意：**不像其他的语句，比如`console.log(amount);`，块语句不需要分号（`;`）来结束它。

## 条件语句

“你是否需要购买额外的屏幕保护膜，特价$9.99美元？”乐于助人的手机店员工询问你的决定。在回答这个问题之前，你可能需要看看你钱包当前的**状态**或者你银行账户的余额。但很明显，这只是一个简单的“是或否”的问题。

这里有许多方法在我们的程序中表示“条件语句”（又称决策）。

最常见的一种是`if`声明。其所表达的意思就是“**如果**这个条件为真，执行如下操作...”。例如：

```js
var bank_balance = 302.13;
var amount = 99.99;

if (amount < bank_balance) {
	console.log( "I want to buy this phone!" );
}
```

`if`语句中要求括号之间的表达式`()`能被视为`true`或`false`。在这个程序中，我们提供的表达式`amount < bank_balance`，它确实被计算为`true`或者`false`，这取决于变量`bank_balance`中值的大小。

如果条件是不正确的，你可以提供另一个选择，我们称之为`else`子句。考虑如下：

```js
const ACCESSORY_PRICE = 9.99;

var bank_balance = 302.13;
var amount = 99.99;

amount = amount * 2;

// can we afford the extra purchase?
if ( amount < bank_balance ) {
	console.log( "I'll take the accessory!" );
	amount = amount + ACCESSORY_PRICE;
}
// otherwise:
else {
	console.log( "No, thanks." );
}
```

在这里，如果`amount < bank_balance`是`true`，我们就会打印出`"I'll take the accessory!"`并且为变量`amount`加上值`9.99`。否则，`else`子句就会输出`"No, thanks."`，并且变量`amount`不会发生改变。

正如我们之前在“值和类型”中说讨论的那样，如果我们的值不是我们预期的类型，JS就会隐式的转换这个值到我们预期的类型。`if`语句希望得到一个`boolean`，但是如果你传递一个不是`boolean`类型的值过去，类型转换就会出现。

JavaScript定义了一些值，它们被认为是假值（`falsy`），因为当它们被强制转换为`boolean`，它们是`false`——这些假值包括像`0`和`""`等。其他不在这个名单中的值被认为是真值（`truthy`）——当他们会被强制转换为`true`。真值包括像`99.99`和`"free"`等值。请参阅第二章的“真值与假值”以获取更多信息。

**条件语句**除了在`if`中出现，也存在于其他形式的语句中。例如，`switch`语句可以当作是一系列`if..else`语句的简写（参见第二章）。循环（参见“循环”）使用**条件语句**来决定循环应该继续还是停止。

**注意：**想要获取更深层次的有关在**条件语句**中发生隐式转换的信息，请参阅这个系列中的“类型和语法”的第四章。

## 循环

在繁忙的时候，手机店员工有一个想要购买手机客户的等待名单。只要这个名单中还有人，她就会继续为下一个客户服务。

重复一组动作，直到在一定条件下失败——换句话说，仅在条件成立才重复——这是编程循环所做的工作；循环可以有多种表现形式，但是它们都满足这个基本行为。

一个循环包括测试条件以及一个代码块（通常为`{ .. }`）。每次循环执行这个代码块，我们称之为一次**迭代**。

例如，`while`循环和`do..while`循环这种形式表示重复执行一个语句块，直到条件的计算结果不再为`true`：

```js
while (numOfCustomers > 0) {
	console.log( "How may I help you?" );

	// help the customer...

	numOfCustomers = numOfCustomers - 1;
}

// versus:

do {
	console.log( "How may I help you?" );

	// help the customer...

	numOfCustomers = numOfCustomers - 1;
} while (numOfCustomers > 0);
```

这两个循环之间的唯一区别在于是否在第一次迭代之前（`while`）还是在第一次迭代之后（`do..while`）测试条件语句。

在任一形式中，如果条件测试为`false`，将不会执行下一次迭代。这意味着，如果初始条件为`false`，`while`循环将永远不会执行，但`do..while`会循环一次。

有时为了某个目的你需要循环一组数字，就像从`0`到`9`（10个数字）.你可以通过设置循环迭代变量如`i`的值为`0`，然后每次迭代都递增`1`来实现它。

**警告：**由于各种历史原因，编程语言几乎都是从0开始计算的，这意味着循环以`0`开始，而不是`1`。如果你不熟悉这种思维模式，刚开始可能会感到很迷惑。花一些时间去适应从`0`开始计数吧！

每次循环都会进行条件测试，就像循环内部有个隐式的`if`声明。

我们可以使用JavaScript的`break`语句来终止循环。如果没有`break`机制，你会发现你很容易就创建了一个永远不会停止的循环（死循环）。

让我们来举例说明：

```js
var i = 0;

// a `while..true` loop would run forever, right?
while (true) {
	// stop the loop?
	if ((i <= 9) === false) {
		break;
	}

	console.log( i );
	i = i + 1;
}
// 0 1 2 3 4 5 6 7 8 9
```

**警告：**这不一定是你想使用的循环形式。它在这里出现仅仅是处于演示说明的目的。

虽然`while` (或`do..while`)能很好的完成循环的任务，但是这里还有另外一种循环形式也能完成循环操作，我们称之为`for`循环：

```js
for (var i = 0; i <= 9; i = i + 1) {
	console.log( i );
}
// 0 1 2 3 4 5 6 7 8 9
```

正如你所见，在两种循环形式中，条件语句`i <= 9`都是在第10次迭代（`i`的值从`0`递增到`9`）变成`false`（此时`i`的值为`10`）的。

`for`循环有三个子句：初始化语句（`var i=0`），条件测试语句（`i <= 9`）和更新语句（`i = i + 1`）。因此，如果你打算用循环迭代来做计算，`for`循环表现的更加紧凑，而且更容易理解和编写。

这里也有其他特殊的循环形式用于迭代特定的值，例如对象的属性（参见第二章），它隐含的条件测试是是否所有的属性都被处理过。不管循环以什么形式表现，但循环的核心理念就是“循环，直到条件失败”，切记！

## 函数

手机店员工可能不会一直用计算器来计算税款和最终的购买量。这是一个她需要定义一次并且重复使用的任务。事实上，公司已经将类似校验寄存器（电脑、平板电脑等）的这些**功能**内置。

同样的，你的程序肯定想要将代码任务拆分成可重用的块，而不是一再重复你自己。要完成这个，你只需要定义一个`function`（函数）。

函数是一个被命名的代码块，它能通过名字被**调用**，然后它里面的代码就会被执行。考虑如下：

```js
function printAmount() {
	console.log( amount.toFixed( 2 ) );
}

var amount = 99.99;

printAmount(); // "99.99"

amount = amount * 2;

printAmount(); // "199.98"
```

函数可以接受参数（可选）——你传递进去的值。函数也可以选择性的返回一个值。

```js
function printAmount(amt) {
	console.log( amt.toFixed( 2 ) );
}

function formatAmount() {
	return "$" + amount.toFixed( 2 );
}

var amount = 99.99;

printAmount( amount * 2 );		// "199.98"

amount = formatAmount();
console.log( amount );			// "$99.99"
```

函数`printAmount（..）`需要一个叫`amt`的参数。函数`formatAmount()`返回了一个值。当然，你也可以在一个函数中结合这两种技术。

函数通常用于组织那些你计划多次调用的代码，但是你如果只是想要组织你的代码，整理到集合中，函数对你来说也是很有用的，即使你只打算调用一次。

考虑如下：

```js
const TAX_RATE = 0.08;

function calculateFinalPurchaseAmount(amt) {
	// calculate the new amount with the tax
	amt = amt + (amt * TAX_RATE);

	// return the new amount
	return amt;
}

var amount = 99.99;

amount = calculateFinalPurchaseAmount( amount );

console.log( amount.toFixed( 2 ) );		// "107.99"
```

虽然`calculateFinalPurchaseAmount（..）`只调用一次，组织其行为到一个单独命名的函数使得使用它的代码逻辑（`amount = calculateFinal...`语句）更清晰。如果函数里面有更多的语句，带来的好处会更加明显。

### 作用域

如果你询问手机店员工一款她店里不存在的手机型号，她不能卖给你你想要的那款手机。她只能访问她店里的库存手机。你必须尝试去其他店里看看能不能找到你想要的手机。

编程对这个概念有个术语：**作用域**（技术上称为**词法范围**）。在JavaScript中，每个函数都有自己的作用域。作用域是指一组变量以及如何通过名称访问这些变量的规则的集合。只有在函数内部的代码才能访问函数**作用域**内部的变量。

在相同的作用域中，一个变量的名字必须是唯一的——这里不允许出现两个变量`a`。但是相同的变量名`a`可以出现在不同的作用域中。

```js
function one() {
	// this `a` only belongs to the `one()` function
	var a = 1;
	console.log( a );
}

function two() {
	// this `a` only belongs to the `two()` function
	var a = 2;
	console.log( a );
}

one();		// 1
two();		// 2
```

此外，一个作用域可以嵌套在另外一个作用域中，就像在生日聚会上的小丑炸毁一个气球中的另外一个气球。如果一个作用域嵌套在另一个作用域里面，最里面的作用域中的代码可以访问外层作用域的变量。

考虑如下：

```js
function outer() {
	var a = 1;

	function inner() {
		var b = 2;

		// we can access both `a` and `b` here
		console.log( a + b );	// 3
	}

	inner();

	// we can only access `a` here
	console.log( a );			// 1
}

outer();
```

词法作用域规则说明一个作用域里面的代码可以访问该作用域或者任何外层作用域范围的变量。

因此，`inner()`函数可以访问变量`a`和变量`b`，但是`outer()`函数中的代码只能访问`a`——它不能访问`b`，因为变量`b`只在函数`inner()`中（才能被访问到）。

回想一下前面这段代码：

```js
const TAX_RATE = 0.08;

function calculateFinalPurchaseAmount(amt) {
	// calculate the new amount with the tax
	amt = amt + (amt * TAX_RATE);

	// return the new amount
	return amt;
}
```

常量`TAX_RATE`可以在函数`calculateFinalPurchaseAmount(..)`内部被访问到，尽管我们没有当作参数传递给这个函数，就是因为词法作用域规则。

**注意：**想要了解更多有关词法作用域的信息，请参阅本系列**作用域和闭包**的前三个章节。

## 实践

学习编程最好的方法就是实践。对我而言，写再多的代码也不为过。（翻译不来，原句：There is absolutely no substitute for practice in learning programming. No amount of articulate writing on my part is alone going to make you a programmer.）

考虑到这一点，让我们试着练习一些我们在本章这里学到的概念。我给出了如下**需求**，你试着实现它们。然后可以参考一下我是如何实现的。

* 编写一个程序来计算你购买的手机的总价。你会一直购买手机（提示：循环！）直到你银行账户里的钱花光为止。你还可以为每个手机购买配件，只要你的购买量低于你的心理消费门槛就行。
* 在你计算完你的采购金额后，加上税收，然后打印出计算后的购买总额（格式化后输出）。
* 最后，检查你的银行账户余额与当前购买价格，看看你能否买得起。
* 你应该将诸如“税率”、“手机价格”、“配件价格”和“消费阈值”（“spending threshold”）设置为常量，以及将你的“银行账户余额”设置为变量。
* 你应该定义计算税收和格式化价格（在价格前面加上“$”并且保留两位小数）的函数
* **额外挑战：**尝试在这个程序中整合输入，可能是`prompt(..)`或者其他的。例如，你可以提示用户输入他们的银行账户余额。（原句：**Bonus Challenge:** Try to incorporate input into this program, perhaps with the `prompt(..)` covered in "Input" earlier. You may prompt the user for their bank account balance, for example. Have fun and be creative!）

好的，开始实现它吧。尝试一下，在你做完之前，不要偷看我的代码哦！

**注意：**因为这是一本讲解JavaScript的书，很显然我会用JavaScript来解决这些练习题。但是如果用其他语言实现对你来说很容易的话也是可以的。

下面是我用JavaScript实现的练习题解决方法：

```js
const SPENDING_THRESHOLD = 200;
const TAX_RATE = 0.08;
const PHONE_PRICE = 99.99;
const ACCESSORY_PRICE = 9.99;

var bank_balance = 303.91;
var amount = 0;

function calculateTax(amount) {
	return amount * TAX_RATE;
}

function formatAmount(amount) {
	return "$" + amount.toFixed( 2 );
}

// keep buying phones while you still have money
while (amount < bank_balance) {
	// buy a new phone!
	amount = amount + PHONE_PRICE;

	// can we afford the accessory?
	if (amount < SPENDING_THRESHOLD) {
		amount = amount + ACCESSORY_PRICE;
	}
}

// don't forget to pay the government, too
amount = amount + calculateTax( amount );

console.log(
	"Your purchase: " + formatAmount( amount )
);
// Your purchase: $334.76

// can you actually afford this purchase?
if (amount > bank_balance) {
	console.log(
		"You can't afford this purchase. :("
	);
}
// You can't afford this purchase. :(
```

**注意：**运行此JavaScript程序最简单的方法就是将其输入到浏览器的开发者控制台中。

你是如何实现的？在你看了我的实现代码之后，再去尝试一遍也无妨。试着改变一些变量的值，看看程序会如何运行。

## 总结

学习编程并不是一个复杂和压倒性的过程。你只需要在大脑中记住一些基本的概念。

这就像是搭积木。要建立高塔，你需要一块一块的堆积积木。对编程来说也是一样。下面是一些基本的编程积木：

* 你需要通过**操作符**来操作值
* 你需要值和**类型**来执行不同的操作，如数学运算用`number`，输出用`string`
* 在程序执行过程中，你需要**变量**来存储数据（即**状态**）
* 你需要**条件语句**如`if`语句来做决定
* 你需要**循环**来重复执行任务，直到判断条件不为真（才停止）
* 你需要**函数**将你的代码组织逻辑，编程可复用的代码块

代码注释是一种有效的方式来编写更加易读的代码，这使得你的程序更容易被理解、维护以及之后出现问题的时候更容易修复。

最后，不要忽视实践的力量。学习如何编写代码最佳的方式就是编写代码，开始动起来吧！

我很高兴看到你在学习如何编程的路上表现很棒。坚持下去。不要忘记去看看其他初级编程的资料（书籍、博客、在线教程等）。本章和本书是一个很好的开端，但是它们只是一个简单的介绍。

下一章将会回顾本章的许多概念，但是会从更具体的JavaScript的角度来看，会重点讲解几个主要的话题，这几个话题我们会在本系列丛书中更加深入的讲解。